<nb-alert status="danger" [style]="userAlreadyExists ? 'display: flex' : 'display: none'">This user already exists</nb-alert>
<nb-alert status="success" [style]="userSuccesfullyAdded ? 'display: flex' : 'display: none'">User successfully added</nb-alert>
<nb-card>
    <nb-card-header class="boldFont">Enter user information below</nb-card-header>
    <nb-card-body>
        <form [formGroup]="addUserForm" class="example-items-columns">
            <div class="two-columns">
                <div [class]="showField ? 'field-margin' : 'full-column field-margin'">
                    <label class="label regularFont">Email</label>
                    <nb-form-field>
                        <input #emailInput nbInput class="regularFont" formControlName="email" [status]="validateField('email')">
                        <button nbSuffix [disabled]="this.emailInput.value.length > 0 ? 'disabled':''" nbButton ghost (click)="loadUserInfo()">
                            <nb-icon icon="search-outline" pack="eva" >
                            </nb-icon>
                        </button>
                    </nb-form-field>
                    <div *ngIf="(submitted || searchUser) && form['email'].errors" class="messageContainer status-danger">
                        <div *ngIf="form['email'].errors['required']" class="hiddenMessage">Email is required.</div>
                        <div *ngIf="form['email'].errors['email']" class="hiddenMessage">Email should have a valid format.</div>
                    </div>
                </div>
                <div class="field-margin" [style]="showField ? 'display: block' : 'display: none'">
                    <label class="label regularFont">Is CGIAR User?</label>
                    <nb-form-field>
                        <nb-select #cgiarUserInput class="regularFont" formControlName="cgiarUser" [(selected)]="cgiarUser" [status]="validateField('cgiarUser')" (selectedChange)="onSelectChange($event)">
                            <nb-option value="Yes">Yes</nb-option>
                            <nb-option value="No">No</nb-option>
                        </nb-select>
                    </nb-form-field>
                    <div *ngIf="submitted && form['cgiarUser'].errors" class="messageContainer status-danger">
                        <div *ngIf="form['cgiarUser'].errors['required']" class="hiddenMessage">Is CGIAR is required.</div>
                    </div>
                </div>
            </div>
            <div class="two-columns">
                <div [class]="showPasswordField ? 'field-margin' : 'one-column field-margin'" [style]="showField ? 'display: block' : 'display: none'">
                    <label class="label regularFont">Username</label>
                    <nb-form-field>
                        <input #usernameInput nbInput class="regularFont" formControlName="username" [status]="validateField('username')" [readonly]="disableField">
                    </nb-form-field>
                    <div *ngIf="submitted && form['username'].errors" class="messageContainer status-danger">
                        <div *ngIf="form['username'].errors['required']" class="hiddenMessage">Username is required.</div>
                    </div>
                </div>
                <div class="field-margin" [style]="showPasswordField && showField ? 'display: block' : 'display: none'">
                    <label class="label regularFont">Password</label>
                    <nb-form-field>
                        <input #passwordInput nbInput class="regularFont" [type]="getInputType()" formControlName="password" [status]="validateField('password')">
                        <button nbSuffix nbButton ghost (click)="toggleShowPassword()">
                            <nb-icon [icon]="showPassword ? 'eye-outline' : 'eye-off-2-outline'" pack="eva" [attr.aria-label]="showPassword ? 'hide password' : 'show password'">
                            </nb-icon>
                        </button>
                    </nb-form-field>
                    <div *ngIf="submitted && form['password'].errors" class="messageContainer status-danger">
                        <div *ngIf="form['password'].errors['required']" class="hiddenMessage">Password is required.</div>
                    </div>
                </div>
            </div>
            <div class="two-columns">
                <div class="field-margin" [style]="showField ? 'display: block' : 'display: none'">
                    <label class="label regularFont">First Name</label>
                    <nb-form-field>
                        <input #firstNameInput nbInput class="regularFont" formControlName="firstName" [status]="validateField('firstName')" [readonly]="disableField">
                    </nb-form-field>
                    <div *ngIf="submitted && form['firstName'].errors" class="messageContainer status-danger">
                        <div *ngIf="form['firstName'].errors['required']" class="hiddenMessage">First Name is required.</div>
                    </div>
                </div>
                <div class="field-margin" [style]="showField ? 'display: block' : 'display: none'">
                    <label class="label regularFont">Last Name</label>
                    <nb-form-field>
                        <input #lastNameInput nbInput class="regularFont" formControlName="lastName" [status]="validateField('lastName')" [readonly]="disableField">
                    </nb-form-field>
                    <div *ngIf="submitted && form['lastName'].errors" class="messageContainer status-danger">
                        <div *ngIf="form['lastName'].errors['required']" class="hiddenMessage">Last Name is required.</div>
                    </div>
                </div>
            </div>
        </form>
    </nb-card-body>
    <nb-card-footer class="example-items-rows">
        <button nbButton status="success" [disabled]="this.addUserForm.valid && searchUser ? 'disabled' : ''" class="boldFont" (click)="submit(firstNameInput.value, lastNameInput.value, usernameInput.value, cgiarUserInput.selected, emailInput.value, passwordInput.value)">Submit</button>
        <button nbButton status="danger" (click)="cancel()" class="cancel boldFont">Cancel</button>
    </nb-card-footer>
</nb-card>
